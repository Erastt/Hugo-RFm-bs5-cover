---
title: Добавление шрифтов
subtitle: Как подключить и оптимизировать нестандартные шрифты
date: 2021-06-23T16:48:05+03:00
Lastmod: 2021-06-23T16:48:05+03:00
draft: false
# description: A short description of this page, «в двух словах»
summary: Шрифт (нем. Schrift от schreiben «писать») — графический рисунок начертаний букв и знаков, составляющих единую стилистическую и композиционную систему, набор символов определённого размера и рисунка.
author:
  given_name: G-8
  family_name: G-8
  display_name: G-8
categories: [веб-разработка]
# categories: ['web development']
tags: [Atom, Font]
toc: true
---

<svg class="float-start me-2 mt-2" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512">
  <path fill="#9b9b9b"  d="m296 10-14.143 5.857-10 10L266 40v88l7.543 15.646 76.59 65.522-76.781 67.338L266 292v180l5.857 14.143 10 10L296 502h174l14.143-5.857 10-10L500 472V292l-7.543-15.646-78.59-67.577 80.781-61.283L502 132V40l-5.857-14.143-10-10L472 10zm10 40h156v72.51l-80.157 60.773L306 118.357V118zm76.157 184.662L460 301.642V462H306V301.49zM208.423 129.347l-.26-78.934-137.588.54-17.788 17.46-.279 389.255 13.164 4.37 142.927.028-.162-144.084-67.85.077-.024 13.864-40.016.14.035-34.093 19.898-19.956 107.886.057 20.203 20.087.072 173.82-5.865 13.997-9.885 10.056-14 5.802-156.134.143-6.57-1.046-29.956-9.813L12.5 472.152l.042-412.202 5.805-14.019 29.875-30.04 14.027-5.867 156.276.063 14.328 5.906 9.823 9.892 5.925 13.993.052 90.055-40.007.068z"/>
  <path d="m140.563 331.923-40.016.14.035-34.093 19.898-19.956 107.886.057 20.203 20.087.072 173.82-5.865 13.997-9.885 10.056-14 5.802-156.134.143-6.57-1.046-29.956-9.813L12.5 472.152l.042-412.202 5.805-14.019 29.875-30.04 14.027-5.867 156.276.063 14.328 5.906 9.823 9.892 5.925 13.993.052 90.055-40.007.068-.483-79.588-137.588.54-17.788 17.46-.279 389.255 13.164 4.37 142.927.028-.162-144.084-67.85.077zM306 50h156v72.51l-80.157 60.773L306 118.357V50M382.157 234.662 306 301.49V462h154V301.643l-77.843-66.98"/>
  <path fill="none" stroke="grey" d="m350.134 209.168-76.591-65.522L266 128V40l5.857-14.143 10-10L296 10h176l14.143 5.857 10 10L502 40v92l-7.352 15.494-80.782 61.283 78.591 67.577L500 292v180l-5.857 14.143-10 10L470 502H296l-14.143-5.857-10-10L266 472V292l7.352-15.494z"/>
</svg>

## Введение и терминология

Текст — основная часть контента на большинстве сайтов, и важно грамотно подходить к его отрисовке. В этой статье разобраны базовые моменты, касающиеся подключения и оптимизации шрифтов.

Сразу стоит отметить, что самый простой вариант — вообще не подключать сторонние шрифты и пользоваться стандартными, которые предустановлены в большинстве операционных систем. Это хорошо знакомые Arial, Times New Roman и так далее — эти шрифты называются веб-безопасными, достаточно просто указать название одного из таких шрифтов в коде, и всё будет работать.

Но чаще всего дизайн макета требует использовать какой-то нестандартный шрифт. В этом случае при загрузке страницы файл со шрифтом нужно подгружать с сервера по той же схеме, что и другие ресурсы: CSS-файлы, изображения и так далее. Чтобы избежать большинства проблем,при пдкоючении новых шрифтов, необходимо уделить внимание оптимизации.

## Подключение шрифтов с помощью Google Fonts

Для начала стоит выбрать правильный формат шрифта. TTF и OTF — форматы, которые предоставляются с минимальным сжатием или совсем без него. Их стоит использовать только в том случае, если нужна поддержка очень старых браузеров. Во всех остальных ситуациях можно выбрать WOFF и WOFF2 — форматы, которые отличаются высокой степенью сжатия. WOFF2 — усовершенствованная версия предшественника, этот формат можно считать лучшим из существующих. Тем не менее, [поддержка](https://caniuse.com/woff2) WOFF2 хотя и очень хорошая, но пока не абсолютная, поэтому в качестве подстраховки для не самых современных браузеров стоит использовать `WOFF`.

Есть простой и удобный способ подключить нестандартный шрифт — использовать бесплатный сервис [Google Fonts](https://fonts.google.com/). Он позволяет использовать шрифты, не сохраняя их на своём сервере. Чтобы им воспользоваться, необходимо выбрать шрифт и добавить одно или несколько нужных начертаний, а затем вставить в `<head>` ссылку, которую сгенерирует Google Fonts во вкладке Embed.

![фото1](images/G-8_fonts1.png "кнопка загрузки")

Этого достаточно, чтобы шрифт подключился. Теперь его можно использовать в свойстве `font-family` без каких-либо дополнительных действий.
```html
body {
  font-family: "Roboto", "Arial", sans-serif;
}
```
Стоит отметить, что после основного шрифта важно указать один из стандартных. В случае, если нестандартный шрифт не загрузится, браузер воспользуется альтернативным. Его нужно подобрать максимально похожим на основной шрифт.

Плюсы этого способа — простота использования и всегда актуальные версии шрифтов, Google Fonts их часто обновляет. Но у него есть и минус — запросы к сторонним серверам могут негативно повлиять на скорость загрузки страницы. Если выбираете этот способ, стоит обратить внимание на [оптимизацию](https://csswizardry.com/2020/05/the-fastest-google-fonts/).


## Подключение шрифтов с помощью правила @font-face
Есть альтернативный способ, при котором файлы со шрифтами хранятся локально вместе с остальными ресурсами сайта. Для них принято заводить отдельную директорию — например, `fonts`. В неё следует поместить файлы для каждого начертания в нужных форматах — в большинстве случаев, если не требуется поддержка старых браузеров, подойдут .`woff` и .`woff2`, о которых мы говорили ранее. Шрифты можно скачать на [различных ресурсах](https://fontstorage.com/ru/). При этом всегда нужно обращать внимание на лицензию — некоторые шрифты могут быть недоступны для коммерческого использования.

После того, как файлы шрифтов добавлены в проект, их нужно подключить в CSS или SCSS-файле.
Например:
```html
@font-face {
  font-family: "Roboto";
  font-style: normal;
  font-weight: normal;
  src: rl('../fonts/Roboto.woff2') format('woff2'),
  url('../fonts/Roboto.woff') format('woff');
  /* Если браузер не поддерживает woff2, загрузит woff */
}
```
После этого можно использовать загруженные шрифты:
```html
body {
  font-family: "Roboto", "Arial", sans-serif;
}
```
## Оптимизация
Выбор современного формата шрифта, который обладает хорошей степенью сжатия — это только первый шаг к оптимизации. Можно сделать гораздо больше, чтобы увеличить скорость загрузки страницы и сделать пользовательский опыт при взаимодействии с интерфейсом приятнее.

### FOIT, FOUT и FOFT
При [рендеринге](https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%BD%D0%B4%D0%B5%D1%80%D0%B8%D0%BD%D0%B3) можно наблюдать разное поведение текста.

FOIT (Flash of Invisible Text) — с англ. «мелькание невидимого текста». При таком поведении, пока шрифт не загрузится, текст не отображается и появляется только после загрузки шрифта. Значительная проблема — во время загрузки нет доступа к текстовому контенту.

FOUT (Flash of Unstyled Text) — с англ. «мелькание неоформленного текста». Во время загрузки используется шрифт, заданный по умолчанию (системный, например), а после загрузки страница перерисовывается с использованием загрузившегося шрифта. Эта перерисовка довольно заметна и может быть нежелательна.

FOFT (Flash of Faux Text) — с англ. «мелькание синтезированного текста». Это поведение можно наблюдать в промежутке, когда основное начертание уже загрузилось, а дополнительные (жирное, курсивное и так далее) — нет. Браузер имитирует нужное начертание до загрузки настоящей версии. В этом случае страница может перерисовываться несколько раз по мере загрузки начертаний.

В разных браузерах логика рендеринга текста во время загрузки шрифта отличается. Например, Chrome и Firefox в течение трёх секунд не отрисовывают ничего, затем используют веб-безопасный шрифт, а после окончания загрузки текст перерисовывается. IE поступает похоже, но при этом не ждёт три секунды. Подобное поведение в разных браузерах можно унифицировать, используя свойство `font‑display`.

### Свойство font-display
Это свойство контролирует поведение браузера при рендеринге шрифтов. Всего существует пять вариантов значений:
- `auto` - поведение устанавливает браузер;
- `block`- текст не отображается в течение короткого периода (3 секунды), затем отрисовывается запасной шрифт, если основной ещё не загрузился. Как только загрузка завершается, текст перерисовывается снова;
- `swap` - сразу же отрисовывается запасной шрифт, после загрузки шрифта - повторный рендеринг;
- `fallback` - в течение очень короткого периода (100 миллисекунд) не отображается ничего, затем браузер использует запасной шрифт и ждёт 3 секунды - если шрифт всё ещё не загрузился, остаётся запасной шрифт. Далее не важно, загрузился шрифт или нет, замена не произойдёт. Если шрифт загрузится, то он применится только при обновлении страницы;
- `optional` - текст не отображается в течение 100 миллисекунд, а затем отрисовывается запасным шрифтом. Даже если шрифт загрузится после этого, замена произойдёт только при обновлении страницы.

Наиболее ораспространённые значения свойства: `swap` и `optional`.

### Предзагрузка шрифтов
Ещё один способ оптимизации — предварительная загрузка шрифтов. С её помощью можно изменить обычную приоритизацию загрузки ресурсов, тем самым сказав браузеру, что важно загрузить шрифт в первую очередь.

Стоит учесть, что браузер загрузит шрифт в любом случае — даже если он не используется на странице. И, обладая высоким приоритетом, эта загрузка может блокировать загрузку других ресурсов, поэтому нужно грамотно выбирать, что именно предзагружать. Например, если на странице используются три разных шрифта, стоит предзагрузить только основной шрифт без дополнительных начертаний.

Для того, чтобы предзагрузка сработала, нужно поместить в `<head>` ссылку на шрифт и задать атрибуту `rel` значение `preload`:
```html
<link rel="preload" href="/fonts/Roboto.woff2" as="font">
```
Также необходимо добавить тип ресурса, в данном случае — `font`.

### Уменьшение количества глифов шрифта
По умолчанию шрифт может содержать глифы (буквы, символы) разных языков и просто редко используемые. С помощью свойства `unicode-range` можно установить диапазон нужных символов в системе Unicode, тогда браузер будет подгружать сабсет (подмножество) шрифта только в тот момент, когда на странице появится символ из этого диапазона. Предварительно нужно подготовить файлы шрифтов, разбив их на группы.

Например, можно отдельно подключить латиницу и кириллицу, если на сайте представлены версии на двух языках. И с помощью `unicode-range` браузер поймёт, какой сабсет нужен для конкретной страницы, и загрузит только его. Такой файл будет иметь меньший вес и ускорит загрузку страницы.

Также можно проанализировать, какие конкретно глифы используются на сайте и создать кастомный сабсет исключительно с ними. Для этого есть [специальные инструменты](https://github.com/filamentgroup/glyphhanger).

[Ссылка на материалы статьи](https://htmlacademy.ru/blog/boost/tutorial/fonts-loading)
